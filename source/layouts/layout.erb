<!doctype html>
<html>
  <head>
    <meta charset="utf-8">

    <!-- Always force latest IE rendering engine or request Chrome Frame -->
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width">

    <!-- Use title if it's in the page YAML frontmatter -->
    <title><%= current_page.data.title || "A Work in Progress" %></title>

    <!-- <link href='http://fonts.googleapis.com/css?family=Oxygen:400,300'
    rel='stylesheet' type='text/css'> -->
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,400,300,700' rel='stylesheet' type='text/css'>
    <%= stylesheet_link_tag "normalize", "all" %>
    <%= javascript_include_tag  "all" %>
  </head>

  <body>
    <div class="secret-button">
      <a href="/adventure-mode">
        <i class="fa fa-gamepad"></i>
      </a>
    </div>
    <div class="container">
      <% klass = 'left' %>
      <% blog.articles.each.with_index do |article, i| %>
        <%
        if article.path == current_page.path ||
          (klass == "left" && current_page.path == "index.html")
          klass = ""
        elsif klass == ""
          klass = "right"
        end
        %>

      <div class="page-container <%=klass%>" data-url="<%=article.url%>">
        <div class="page <%= article.data.color_scheme || 'clouds' %>">
          <nav class="page-nav">
            <div class="left <% if i == 0 %>inactive<% end %>">
                <a href="#" class="prev">
                  <i class="fa fa-chevron-left"></i>
                </a>
            </div>

            <div class="right <% if i == blog.articles.size - 1 %>inactive<% end %>">
                <a href="#" class="next">
                  <i class="fa fa-chevron-right"></i>
                </a>
            </div>

            <div class="center button-container">
              <a href="/" class="home">
                <i class="fa fa-home"></i>
              </a>
              <a href="https://github.com/aschepis" class="about">
                <i class="fa fa-github"></i>
              </a>
              <a href="https://twitter.com/aschepis" class="about">
                <i class="fa fa-twitter"></i>
              </a>
            </div>
          </nav>

          <div class="post-content" tabindex="0">
            <h1 class="title"><%=article.title%></h1>
            <h3 class="author-info">Written by Adam Schepis</h3>
            <h3 class="published-date">Originally Published <%= article.date %></h3>
            <div class="post-actions">
              <a href="#"
                 class="toggle-comments"
                 onclick="loadDisqus(jQuery(this), '<%= article.url %>', 'http://adamschepis.com<%= article.url %>');">
                <i class="octicon octicon-comment-discussion"></i> (leave your thoughts)
              </a>
            </div>
            <div class="post-body" data-url="<%=article.url%>">
              <% if article.url == current_page.url %>
                <%= article.body %>
              <% end %>
            </div>
          </div>
        </div>
        <div class="page-back flipped <%= article.data.color_scheme || 'clouds' %>">
          <div class="post-content" tabindex="0">
            <h1 class="subtitle">Comments on "<%=article.title%>"</h1>
            <div class="post-actions">
              <a href="#" onclick="clearDisqus(jQuery(this));" class="toggle-comments"><i class="octicon octicon-mail-reply"></i> Back to the article.</a>
              <div class="comments"></div>
            </div>
            <div>
            </div>
          </div>
        </div>
      </div>
      <% end %>
    </div>
  </body>
  <script type="text/javascript">
    $(function() {
      var dynframe = function(src) {return $('<iframe src="'+src+'"></iframe>');}
      <% blog.articles.each do |article| %>
      <% unless article.url == current_page.url %>
      {
        var iframe = dynframe('/raw-content<%=article.url.gsub(/\.html$/, '')%>');
        $('body').append(iframe);
        iframe.one('load', function() {
          var html = $(this).contents().find('body').html()
          $(".post-body[data-url='<%=article.url%>']").html(html);
          $(this).remove()
        });
      }
      <% end %>
      <% end %>
    });
  </script>
  <script type="text/javascript">
    var disqus_shortname = 'aschepis';
    var disqus_identifier;
    var disqus_url; //post permalink

    function clearDisqus(source) {
      source.closest('.page-back.flipped').find('.comments').html('');
    }
    function loadDisqus(source, identifier, url) {
      source = jQuery(source.closest('.page-container').find('.page-back.flipped .comments'))
      if (window.DISQUS) {
        jQuery('#disqus_thread').insertAfter(source); //append the HTML after the link

        //if Disqus exists, call it's reset method with new parameters
        DISQUS.reset({
          reload: true,
          config: function () {
            this.page.identifier = identifier;
            this.page.url = url;
          }
        });
      } else {
        //insert a wrapper in HTML after the relevant "show comments" link
        jQuery('<div id="disqus_thread"></div>').insertAfter(source);
        disqus_identifier = identifier; //set the identifier argument
        disqus_url = url; //set the permalink argument

        //append the Disqus embed script to HTML
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        jQuery('head').append(dsq);
      }
    };
  </script>
</html>
